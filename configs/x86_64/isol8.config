# isol8 PV guest kernel config
# Minimal hardened config for Xen PV container runtime guests.
# Security: no modules, no IA32/x32, no io_uring, no debug.
# Target: x86_64 Xen PV guest running styrolite containers.

# General setup
CONFIG_EXPERT=y
CONFIG_LOCALVERSION="-isol8"
CONFIG_DEFAULT_HOSTNAME="isol8-guest"
CONFIG_SYSVIPC=y
CONFIG_POSIX_MQUEUE=y
CONFIG_NO_HZ_IDLE=y
CONFIG_HIGH_RES_TIMERS=y
CONFIG_PREEMPT_VOLUNTARY=y
CONFIG_PRINTK=y
CONFIG_BUG=y
CONFIG_FUTEX=y
CONFIG_EPOLL=y
CONFIG_SIGNALFD=y
CONFIG_TIMERFD=y
CONFIG_EVENTFD=y
CONFIG_AIO=y
CONFIG_MULTIUSER=y
CONFIG_FHANDLE=y

# Architecture
CONFIG_64BIT=y
CONFIG_X86_64=y
CONFIG_SMP=y

# Security hardening — explicitly disabled
CONFIG_MODULES=n
CONFIG_X86_X32_ABI=n
CONFIG_IA32_EMULATION=n
CONFIG_COMPAT=n
CONFIG_IO_URING=n
CONFIG_DEBUG_KERNEL=n
CONFIG_KALLSYMS=n
CONFIG_DEBUG_INFO=n
CONFIG_FTRACE=n
CONFIG_MAGIC_SYSRQ=n
CONFIG_KEXEC=n

# Xen PV support (critical)
CONFIG_HYPERVISOR_GUEST=y
CONFIG_PARAVIRT=y
CONFIG_PARAVIRT_SPINLOCKS=y
CONFIG_XEN=y
CONFIG_XEN_PV=y
CONFIG_XEN_PV_SMP=y
CONFIG_XEN_PVHVM=n
CONFIG_XEN_SAVE_RESTORE=y
CONFIG_XEN_BALLOON=y
CONFIG_XEN_SCRUB_PAGES_DEFAULT=y

# Xen console (HVC — IDM transport via /dev/hvc0)
CONFIG_HVC_DRIVER=y
CONFIG_HVC_XEN=y
CONFIG_HVC_XEN_FRONTEND=y

# Block devices + Xen PV block frontend (squashfs VBDs from dom0)
CONFIG_BLOCK=y
CONFIG_BLK_DEV=y
CONFIG_XEN_BLKDEV_FRONTEND=y

# Squashfs (read-only compressed image layers via VBD)
CONFIG_SQUASHFS=y
CONFIG_SQUASHFS_ZLIB=y
CONFIG_SQUASHFS_LZO=y
CONFIG_SQUASHFS_XZ=y
CONFIG_SQUASHFS_ZSTD=y

# Overlay filesystem (container image layers)
CONFIG_OVERLAY_FS=y

# 9P filesystem (rootfs from dom0 via Xen transport — legacy compat)
CONFIG_NET_9P=y
CONFIG_NET_9P_XEN=y
CONFIG_9P_FS=y
CONFIG_9P_FS_POSIX_ACL=y
CONFIG_9P_FS_SECURITY=y

# Xen networking (vif frontend)
CONFIG_NETDEVICES=y
CONFIG_XEN_NETDEV_FRONTEND=y

# Namespaces (container isolation inside guest)
CONFIG_NAMESPACES=y
CONFIG_UTS_NS=y
CONFIG_IPC_NS=y
CONFIG_USER_NS=y
CONFIG_PID_NS=y
CONFIG_NET_NS=y

# Cgroups
CONFIG_CGROUPS=y
CONFIG_CGROUP_SCHED=y
CONFIG_CGROUP_PIDS=y
CONFIG_CGROUP_DEVICE=y
CONFIG_CGROUP_CPUACCT=y
CONFIG_CGROUP_FREEZER=y
CONFIG_MEMCG=y
CONFIG_CPUSETS=y

# Networking
CONFIG_NET=y
CONFIG_PACKET=y
CONFIG_UNIX=y
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
CONFIG_IP_ADVANCED_ROUTER=y
CONFIG_IP_MULTIPLE_TABLES=y
CONFIG_IPV6=y
CONFIG_NETFILTER=y
CONFIG_NETFILTER_ADVANCED=y
CONFIG_NF_CONNTRACK=y
CONFIG_NF_NAT=y
CONFIG_NETFILTER_XTABLES=y
CONFIG_BRIDGE=y
CONFIG_BRIDGE_NETFILTER=y
CONFIG_VETH=y
CONFIG_TUN=y
CONFIG_NET_SCHED=y
CONFIG_NET_SCH_DEFAULT=y

# Seccomp
CONFIG_SECCOMP=y
CONFIG_SECCOMP_FILTER=y

# Security
CONFIG_SECURITY=y
CONFIG_SECURITY_YAMA=y
CONFIG_SECURITY_LANDLOCK=y
CONFIG_LSM="landlock,yama"

# Filesystems
CONFIG_PROC_FS=y
CONFIG_PROC_SYSCTL=y
CONFIG_PROC_CHILDREN=y
CONFIG_SYSFS=y
CONFIG_TMPFS=y
CONFIG_TMPFS_POSIX_ACL=y
CONFIG_TMPFS_XATTR=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y
CONFIG_DEVPTS_FS=y

# initramfs
CONFIG_BLK_DEV_INITRD=y
CONFIG_RD_GZIP=y
CONFIG_RD_BZIP2=n
CONFIG_RD_LZMA=n
CONFIG_RD_XZ=n
CONFIG_RD_LZO=n
CONFIG_RD_LZ4=n
CONFIG_RD_ZSTD=n

# TTY / console
CONFIG_TTY=y
CONFIG_VT=n
CONFIG_UNIX98_PTYS=y
CONFIG_SERIAL_8250=n

# Crypto (minimal)
CONFIG_CRYPTO_MANAGER=y
CONFIG_CRYPTO_MANAGER_DISABLE_TESTS=y

# Disabled — not needed in PV guests
CONFIG_SOUND=n
CONFIG_USB_SUPPORT=n
CONFIG_INPUT=n
CONFIG_SERIO=n
CONFIG_HW_RANDOM=n
CONFIG_DRM=n
CONFIG_FB=n
CONFIG_VGA_CONSOLE=n
CONFIG_AGP=n
CONFIG_PCCARD=n
CONFIG_ATA=n
CONFIG_MD=n
CONFIG_ACPI=n
CONFIG_PCI=n
CONFIG_DMI=n
CONFIG_FIRMWARE_MEMMAP=n
CONFIG_WIRELESS=n
CONFIG_RFKILL=n
CONFIG_WLAN=n
CONFIG_BT=n
CONFIG_MEDIA_SUPPORT=n
CONFIG_THERMAL=n
CONFIG_WATCHDOG=n
CONFIG_HWMON=n
CONFIG_IOMMU_SUPPORT=n
CONFIG_STAGING=n
CONFIG_POWER_SUPPLY=n
CONFIG_RC_CORE=n
CONFIG_LEDS_CLASS=n
